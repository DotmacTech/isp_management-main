# OpenAPI Documentation Standards

This document outlines the standards for API documentation in the ISP Management Platform using OpenAPI/Swagger.

## Overview

The ISP Management Platform uses FastAPI's built-in OpenAPI integration to generate comprehensive API documentation. This ensures that all endpoints are well-documented and easily discoverable by developers and API consumers.

## Documentation Requirements

All API endpoints must include:

1. **Summary and Description**: Clear, concise description of what the endpoint does
2. **Request Parameters**: All path, query, and header parameters with descriptions
3. **Request Body**: Schema with field descriptions and validation rules
4. **Response Schemas**: All possible response types with status codes
5. **Error Responses**: Standard error responses with examples
6. **Tags**: Appropriate grouping tags for organization
7. **Security Requirements**: Authentication requirements

## Pydantic Schema Documentation

Pydantic schemas should include:

1. **Field Descriptions**: Document each field with a clear description
2. **Validation Rules**: Document min/max values, regex patterns, etc.
3. **Example Values**: Provide realistic example values
4. **Deprecated Fields**: Mark deprecated fields with explanation

Example:
```python
class UserCreate(BaseModel):
    """
    Schema for creating a new user.
    """
    username: str = Field(
        ..., 
        description="Unique username for the user",
        example="john_doe",
        min_length=3,
        max_length=50
    )
    email: EmailStr = Field(
        ..., 
        description="User's email address",
        example="john.doe@example.com"
    )
    password: str = Field(
        ..., 
        description="User's password (will be hashed)",
        example="SecureP@ssw0rd",
        min_length=8
    )
    full_name: Optional[str] = Field(
        None, 
        description="User's full name",
        example="John Doe"
    )
```

## Endpoint Documentation

Endpoint functions should include:

1. **Docstrings**: Detailed explanation of the endpoint's purpose
2. **Parameter Documentation**: Description for each parameter
3. **Response Documentation**: Description of the response structure
4. **Status Codes**: All possible status codes with explanations

Example:
```python
@router.post("/users/", response_model=UserResponse, status_code=status.HTTP_201_CREATED, tags=["Users"])
async def create_user(
    user: UserCreate,
    db: Session = Depends(get_db),
    current_user: User = Depends(get_current_superuser)
):
    """
    Create a new user.
    
    This endpoint allows administrators to create new user accounts.
    The password will be automatically hashed.
    
    Args:
        user: User creation data
        db: Database session
        current_user: Current authenticated user (must be superuser)
        
    Returns:
        The created user information
        
    Raises:
        HTTPException 400: If username or email already exists
        HTTPException 401: If not authenticated
        HTTPException 403: If not a superuser
    """
    # Implementation...
```

## Error Handling Documentation

Standardize error responses with:

1. **Consistent Structure**: Use a standard error response schema
2. **Error Codes**: Use consistent error codes across the API
3. **Descriptive Messages**: Clear error messages that explain the issue
4. **Troubleshooting Hints**: Where appropriate, include hints for fixing the error

Example error response schema:
```python
class ErrorResponse(BaseModel):
    """
    Standard error response schema.
    """
    detail: str = Field(..., description="Error message")
    error_code: str = Field(..., description="Error code")
    timestamp: datetime = Field(..., description="Error timestamp")
    path: str = Field(..., description="Request path")
    
    class Config:
        schema_extra = {
            "example": {
                "detail": "User with email 'john.doe@example.com' already exists",
                "error_code": "USER_ALREADY_EXISTS",
                "timestamp": "2025-03-15T07:30:45.123Z",
                "path": "/api/v1/users/"
            }
        }
```

## OpenAPI Extensions

Use OpenAPI extensions to enhance documentation:

1. **x-logo**: Add the ISP Management Platform logo
2. **x-tagGroups**: Group related tags for better organization
3. **x-examples**: Provide multiple examples for complex schemas
4. **x-code-samples**: Include code samples in multiple languages

## Documentation Generation

The OpenAPI documentation is automatically generated by FastAPI and available at:

- Swagger UI: `/docs`
- ReDoc: `/redoc`
- OpenAPI JSON: `/openapi.json`

## Module-Specific Documentation

Each module should provide:

1. **Module Overview**: Description of the module's purpose and functionality
2. **Entity Relationships**: Diagram of the module's data model
3. **Common Use Cases**: Examples of common API usage patterns
4. **Integration Points**: How the module integrates with other modules

## Versioning

API versioning should be reflected in the documentation:

1. **Version in URL**: Include the version in the URL path (e.g., `/api/v1/users/`)
2. **Version in Documentation**: Clearly indicate the API version in documentation
3. **Deprecation Notices**: Mark deprecated endpoints with notices and migration paths

## Example: AI Chatbot Module

The AI Chatbot module follows these documentation standards and can be used as a reference implementation. Key endpoints include:

- `POST /api/v1/chatbot/query`: Process a natural language query
- `POST /api/v1/chatbot/feedback`: Submit feedback on a chatbot response
- `GET /api/v1/chatbot/history`: Get query history for the current user
- `GET /api/v1/chatbot/config`: Get AI service configurations
- `POST /api/v1/chatbot/config`: Create a new AI service configuration
